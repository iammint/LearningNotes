# JSæ¨¡å—åŒ–
> å°†ä»£ç æ‹†åˆ†æˆç‹¬ç«‹çš„å—ï¼Œç„¶åå†æŠŠè¿™äº›å—è¿æ¥èµ·æ¥ï¼Œå¯ä»¥é€šè¿‡æ¨¡å—æ¨¡å¼æ¥å®ç°ã€‚
> 
> å—çš„å†…éƒ¨æ•°æ®/å®ç°æ˜¯ç§æœ‰çš„ï¼Œåªæ˜¯å‘å¤–æš´éœ²ä¸€äº›æ¥å£ï¼Œä¸å…¶å®ƒæ¨¡å—é€šä¿¡

# è½¯ä»¶åŒ…packages
è½¯ä»¶åŒ…æ˜¯å¯ä»¥å¤åˆ¶å’Œå®‰è£…çš„ä¸€å¤§å—ä»£ç ã€‚å®ƒå¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—ï¼Œè€Œä¸”åŒ…å«å…¶ä¾èµ–çš„å…¶ä»–è½¯ä»¶åŒ…çš„ä¿¡æ¯ã€‚

### Module
- imports(dependencies)
- code
- exports

## 1. åŒ¿åé—­åŒ…
> å‡½æ•°æ˜¯JavaScriptå”¯ä¸€çš„Local Scope
```js
let Module = (function() {
    let _private = "safe now"
    let foo = function() {
        console.log(_private)
    }
    return {
        foo: foo
    }
})()
Module.foo()
console.log(Module._private) //undefined
```

ğŸ‘‡ä»¥å½¢å‚çš„å½¢å¼å¼•å…¥ä¾èµ–
```js
let Module = (function($) {
    let _$body = $("body")
    let foo = function() {
        console.log(_$body)
    }
    return {
        foo: foo
    }
})(jQuery)
Module.foo()
//åˆ©ç”¨windowæš´éœ²å¯¹è±¡ï¼Œå°†$å’ŒjQueryæ·»åŠ ç»™äº†window
```

## 2. ä¸ºä»€ä¹ˆè¦æ¨¡å—åŒ–ï¼Ÿ
1. é¿å…å‘½åå†²çª
2. æ›´å¥½åœ°åˆ†ç¦»ï¼ŒæŒ‰éœ€åŠ è½½
3. æé«˜å¤ç”¨æ€§
4. æ–¹ä¾¿ç»´æŠ¤

### ç°å®ä¸­ç¼ºç‚¹
é¡µé¢å¼•å…¥åŠ è½½jsè¯·æ±‚è¿‡å¤šï¼Œä¾èµ–æ¨¡ç³Šï¼Œéš¾ä»¥ç»´æŠ¤

## 3. IIFEæ¨¡å¼
![alt ](../CSSä¸imgå¼•ç”¨/V2/module.png)
```js
//module.jsä¸­
let obj = {
    msg: "module",
    foo() {
        console.log("foo", this.msg)
    }
}

//htmlä¸­
obj.foo()//foo module

//ä¿®æ”¹msg
obj.msg = "module2"
obj.foo() //foo module2
```

```js
//module.jsä¸­
(function(window) {
    let msg = "module3"
    function foo() {
        console.log("foo", msg)
    }
    //æš´éœ²æ¥å£
    window.module3 = {
        foo: foo
    }
    //window.module3 = {foo}
})(window)
//htmlä¸­
//æ­¤æ—¶ä¸èƒ½ç›´æ¥åœ¨htmlä¸­ä¿®æ”¹msgï¼Œå› ä¸ºæ²¡æœ‰æ¥å£
module3.foo() //module3
```

```js
//module.jsä¸­
(function(window) {
    let msg = "module4"
    function foo() {
        console.log("foo", msg)
    }
    window.module4 = foo
})(window)

//htmlä¸­
//ç›´æ¥è°ƒç”¨
module4() //foo module4
```

## 4. CommonJS
æ¯ä¸ªJSæ–‡ä»¶éƒ½å¯ä»¥å½“ä½œä¸€ä¸ªæ¨¡å—
- åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ¨¡å—çš„åŠ è½½æ˜¯è¿è¡Œæ—¶åŒæ­¥åŠ è½½çš„
- CommonJSæ¨¡å—è¯­æ³•ä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚å› æ­¤åœ¨æµè§ˆå™¨ç«¯ï¼Œæ¨¡å—éœ€è¦æå‰ç¼–è¯‘æ‰“åŒ…å¤„ç†




### 4.1 æš´éœ²æ¨¡å—
> æš´éœ²çš„æœ¬è´¨ï¼šæš´éœ²çš„éƒ½æ˜¯exportså¯¹è±¡
1. module.exports = value
2. exports.xxx = value

commonJSæ¨¡å—çš„ä¸»è¦æ¦‚å¿µæ˜¯ä¸€ä¸ªåä¸ºrequireçš„å‡½æ•°ï¼Œå½“ä½ ä½¿ç”¨ä¾èµ–é¡¹çš„æ¨¡å—åè°ƒç”¨å®ƒæ—¶ï¼Œå®ƒä¼šç¡®ä¿åŠ è½½æ¨¡å—å¹¶è¿”å›æ¥å£ã€‚

å› ä¸ºåŠ è½½å™¨å°†æ¨¡å—ä»£ç åŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œæ‰€ä»¥æ¨¡å—ä¼šè‡ªåŠ¨è·å¾—å®ƒä»¬çš„å±€éƒ¨ä½œç”¨åŸŸã€‚å®ƒä»¬æ‰€è¦åšçš„å°±æ˜¯è°ƒç”¨requireæ¥è®¿é—®å®ƒä»¬çš„ä¾èµ–é¡¹å¹¶å°†å®ƒä»¬çš„æ¥å£æ”¾åœ¨ç»‘å®šåˆ°exportsçš„å¯¹è±¡ä¸­ã€‚

//åœ¨jsæ–‡ä»¶ä¸­
```js
let user = require('./module.js') //ç›¸å¯¹åœ°å€
```


## 5. ES modules
- æ”¯æŒå¼‚æ­¥Asyn
- 'import'
- 'export'

```js
//import all from utils.js 
import * as utils from './utils'
//only import the first function
import {first} from './utils'
```

//HTML
```js
<script type="module" src="./xxx.js"></script>
```

### 5.1 æ¨¡å—å¯¼å‡º
å¯¼å‡ºæ¨¡å—å¿…é¡»åœ¨æ¨¡å—é¡¶çº§ï¼Œä¸èƒ½åµŒå¥—åœ¨æŸä¸ªå—ä¸­ã€‚

1. å‘½åå¯¼å‡º
```js
//å‘½åè¡Œå†…å¯¼å‡º
export const baz = 'baz'

//å‘½åå­å¥å¯¼å‡º
const foo = 'foo'
export {foo}
//å¯¼å‡ºæ—¶ä¹Ÿå¯ä»¥æä¾›åˆ«åï¼Œä½†æ˜¯åˆ«åå¿…é¡»åœ¨exportå­è¯­å¥ä¸­çš„å¤§æ‹¬å·ä¸­æŒ‡å®š
export {foo as myFoo}
```
2. é»˜è®¤å¯¼å‡º
```js
const foo = 'foo'
export default foo

const foo = 'foo'
const bar = 'bar'
export {foo as default, bar}
```

### 5.2 æ¨¡å—å¯¼å…¥
æ¨¡å—å¯ä»¥é€šè¿‡ä½¿ç”¨importå…³é”®å­—ä½¿ç”¨å…¶ä»–æ¨¡å—å¯¼å‡ºçš„å€¼ï¼Œimportä¹Ÿåªèƒ½å‡ºç°åœ¨æ¨¡å—çš„é¡¶çº§
```js
import {foo} from "./fooModule.js"
```
æ¨¡å—æ ‡è¯†ç¬¦å¯ä»¥æ˜¯ç›¸å¯¹äºå½“å‰æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å‘æ¨¡å—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå¿…é¡»æ˜¯çº¯å­—ç¬¦ä¸²ã€‚

å‘½åå¯¼å‡ºå’Œé»˜è®¤å¯¼å‡ºçš„åŒºåˆ«ä¹Ÿä½¿å¯¼å…¥ä¸åŒã€‚

1. å¯¼å…¥å‘½åå¯¼å‡ºçš„é›†åˆ
> å‘½åå¯¼å‡ºå¯ä»¥ä½¿ç”¨*æ‰¹é‡è·å–å¹¶èµ‹å€¼ç»™ä¿å­˜å¯¼å‡ºé›†åˆçš„åˆ«å
> 
>  æŒ‡åå¯¼å…¥éœ€è¦å°†æ ‡è¯†ç¬¦æ”¾åœ¨importå­å¥ä¸­
```js
const foo = "foo", bar = "bar", baz = "baz"
export{foo, bar, baz}

import * as Foo from './foo.js'
console.log(Foo.foo) //foo

import{foo, bar, baz as myBaz} from './foo.js'

```
2. é»˜è®¤å¯¼å‡ºçš„é›†åˆå¯ä»¥ä½¿ç”¨defaultå…³é”®å­—å¹¶æä¾›åˆ«åæ¥å¯¼å…¥
```js
import {default as foo} from "./foo.js"
```

# 6. Package managers â€”â€” npm

There are two ways of installing packages locally and globally. 

![install-packages-locally-globally.png](https://media.haochen.me/install-packages-locally-globally.png)

Generally, you'll want to install locally in the project folder. 

`npm install < package name >`does two thingsâ€Šâ€”â€Šfirst, it downloads all the code from the package into a folder called `node_modules`. Second, it automatically modifies the `package.json `file to keep track of the package as a project dependency.

This is useful later when sharing a project with othersâ€Šâ€”â€Šinstead of sharing the `node_modules` folder (which can get very large), you only need to share the `package.json` file and other developers can install the required packages automatically with the command   `npm install`.

Looking inside the `node_modules` folder, we can see the moment.`min.js` file in the `node_modules/moment/min` directory. This means we can link to the npm downloaded version of `moment.min.js` in the `index.html` file as follows:

```js
  <script src="node_modules/moment/min/moment.min.js"></script>
```

But thatâ€™s still pretty inconvenient, so next weâ€™ll take a look at how to automate that process as well.

## 6.1 commonJS
CommonJS was started with the goal of specifying an ecosystem for JavaScript outside the browser. And the most well-known of implementation of CommonJS modules is node.js. 

Instead of loading all of moment.min.js with an HTML script tag, you can load it directly in the JavaScript file as follows:

```js
//index.js
let moment = require("moment")
```

<font color="red" size=5>â—Again, this is all great for node.js, but if you tried to use the above code in the browser, youâ€™d get an error saying require is not defined. The browser doesnâ€™t have access to the file system. </font>


## 6.2 Module bundler â€”â€” webpack
A JavaScript module bundler is a tool that gets around the problem with a build step, which has access to the file system to create a final output that is browser compatible. 

Letâ€™s take a look at how to use webpack to get the above `require('moment')` example working in the browser. First we need to install webpack into the project. Webpack itself is an npm package, so we can install it from the command line:
```
$ npm install webpack webpack-cli --save-dev
```

Now we have webpack and webpack-cli installed as packages in the `node_modules` folder. You can use webpack-cli from the command line as follows:
```
$ ./node_modules/.bin/webpack index.js --mode=development
```

This command will find any `require` statements, and replace them with the appropriate code to create a single output file (which by default is **dist/main.js**).

Now we can use it in the html.
```js
  <script src="dist/main.js"></script>
```


Note that weâ€™ll need to run the webpack command each time we change `index.js` to other file:
```
$ ./node_modules/.bin/webpack
```

